digraph DetailedDualScoring {
    // Graph properties
    rankdir=LR;
    label="Detailed Dual Scoring System in Time-MoE";
    labelloc=top;
    fontsize=16;
    fontname="Arial Bold";
    
    // Node properties
    node [style=filled, fontname="Arial", fontsize=10];
    
    // Input
    input [label="Time Series\\n[Batch, Seq, Features]", fillcolor=lightblue, shape=box];
    
    // Embedding
    embed [label="Input Embedding", fillcolor=lightgreen, shape=box];
    
    // Transformer blocks
    transformer [label="Time-MoE\\nTransformer Blocks", fillcolor=lightyellow, shape=box];
    
    // Two pathways after transformer
    latent_path [label="Latent Representation\\nProcessing", fillcolor=lightcyan, shape=box];
    error_path [label="Prediction & Error\\nAnalysis", fillcolor=lightcoral, shape=box];
    
    // Latent space pathway
    similarity [label="Similarity Analysis\\n(Cosine Distance)", fillcolor=khaki, shape=box];
    pattern_rec [label="Pattern Recognition\\n& Expert Selection", fillcolor=lemonchiffon, shape=box];
    latent_score_node [label="Latent Score", fillcolor=lightgoldenrod, shape=ellipse];
    
    // Error pathway
    prediction [label="Multi-Horizon\\nPrediction", fillcolor=palevioletred, shape=box];
    huber_loss [label="Huber Loss\\nCalculation", fillcolor=indianred, shape=box];
    error_score_node [label="Error Score", fillcolor=lightpink, shape=ellipse];
    
    // Score combination
    combiner [label="Score Combiner\\nWeighted Fusion\\n(α × Err + β × Latent)", fillcolor=orchid, shape=box];
    
    // Output
    output [label="Final Forecast", fillcolor=lightblue, shape=box];
    
    // MoE integration
    moe_routing [label="MoE Routing\\nwith Dual Scores", fillcolor=gold, shape=box];
    
    // Connections
    input -> embed;
    embed -> transformer;
    transformer -> latent_path;
    transformer -> error_path;
    
    // Latent pathway
    latent_path -> similarity;
    similarity -> pattern_rec;
    pattern_rec -> latent_score_node;
    
    // Error pathway
    error_path -> prediction;
    prediction -> huber_loss;
    huber_loss -> error_score_node;
    
    // Combine scores
    latent_score_node -> combiner;
    error_score_node -> combiner;
    combiner -> moe_routing;
    moe_routing -> output;
    
    // Labels for pathways
    latent_label [label="Latent Space\\nAnalysis Path", fillcolor=lightgray, shape=note, pos="-2,0!", fixedsize=true, width=1.5, height=0.8];
    error_label [label="Error Analysis\\nPath", fillcolor=lightgray, shape=note, pos="-2,-2!", fixedsize=true, width=1.5, height=0.8];
}